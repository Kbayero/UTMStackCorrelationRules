# https://docs.paloaltonetworks.com/cortex/cortex-xdr/cortex-xdr-pro-admin/logs/cortex-xdr-log-notification-formats (june, 2022)
# Rule version v1.0.0

- name: "Probable hijacking detected by Palo Alto Cortex XDR"
  severity: "High"
  description: "Hijacking is a process in which an attempt is made to hijack a specific element of the Internet environment, 
                using routes that are not authorized. In this hijacking we can find hijacking of urls, domains, dns, browser or session, among many others."
  solution: "We can eliminate them in two different ways: the elimination of malware and other threats through Anti-Malware software, to search for and eliminate malware that antivirus systems cannot find.
      If after using these tools you have still not managed to eradicate the problem, it will be necessary to reconfigure the browser to eliminate the parts that have been altered by the hijackers."
  category: "Privilege Escalation"
  tactic: "Hijack Execution Flow"
  reference:
    - "https://attack.mitre.org/tactics/TA0004/"
    - "https://attack.mitre.org/techniques/T1574/"
  frequency: 60
  cache: 
    - oneOf:
        - field: "logx.paloalto_cortex_xdr.moduleStatusId"
          operator: "in"
          value: "CYSTATUS_MACOS_DLPROT_CWD_HIJACK,CYSTATUS_HOTPATCH_HIJACKING"
        - field: "logx.paloalto_cortex_xdr.act_msg"
          operator: "regexp"
          value: "([Hh]ijack)"
        - field: "logx.paloalto_cortex_xdr.cat"
          operator: "regexp"
          value: "([Hh]ijack)"
        - field: "logx.paloalto_cortex_xdr.msg"
          operator: "regexp"
          value: "([Hh]ijack)"
        - field: "logx.paloalto_cortex_xdr.profile"
          operator: "regexp"
          value: "([Hh]ijack)"
      minCount: 1
      timeLapse: 60
      save:
        - field: "logx.paloalto_cortex_xdr.suser"
          alias: "SourceUser"
        - field: "logx.paloalto_cortex_xdr.src_ip"
          alias: "SourceIP"
        - field: "logx.paloalto_cortex_xdr.src_port"
          alias: "SourcePort"
        - field: "logx.paloalto_cortex_xdr.dest_ip"
          alias: "DestinationIP"
        - field: "logx.paloalto_cortex_xdr.dest_port"
          alias: "DestinationPort"