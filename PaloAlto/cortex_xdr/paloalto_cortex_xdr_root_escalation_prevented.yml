# https://docs.paloaltonetworks.com/cortex/cortex-xdr/cortex-xdr-pro-admin/logs/cortex-xdr-log-notification-formats (june, 2022)
# Rule version v1.0.0

- name: "Probable privilege escalation prevented by Palo Alto Cortex XDR"
  severity: "High"
  description: "Privilege Escalation consists of techniques that adversaries use to gain higher-level permissions on a system or network. 
                Adversaries can often enter and explore a network with unprivileged access but require elevated permissions to follow through on their objectives. 
                Common approaches are to take advantage of system weaknesses, misconfigurations, and vulnerabilities."
  solution: "In addition to implementing a real-time security solution, it is essential to regularly scan all components of the IT infrastructure for vulnerabilities that could allow the penetration of new threats. 
      To do this, you can use an effective vulnerability scanner to find unpatched and insecure operating systems and applications, misconfigurations, weak passwords, and other flaws that attackers can exploit."
  category: "Privilege Escalation"
  tactic: "Exploitation for Privilege Escalation"
  reference:
    - "https://attack.mitre.org/tactics/TA0004/"
    - "https://attack.mitre.org/techniques/T1068/"
  frequency: 60
  cache: 
    - allOf:
        - field: "logx.paloalto_cortex_xdr.moduleStatusId"
          operator: "in"
          value: "CYSTATUS_MACOS_ROOT_ESCALATION_PREVENTED,CYSTATUS_LINUX_ROOT_ESCALATION_PREVENTED"
      minCount: 1
      timeLapse: 60
      save:
        - field: "logx.paloalto_cortex_xdr.suser"
          alias: "SourceUser"
        - field: "logx.paloalto_cortex_xdr.src_ip"
          alias: "SourceIP"
        - field: "logx.paloalto_cortex_xdr.src_port"
          alias: "SourcePort"
        - field: "logx.paloalto_cortex_xdr.dest_ip"
          alias: "DestinationIP"
        - field: "logx.paloalto_cortex_xdr.dest_port"
          alias: "DestinationPort"